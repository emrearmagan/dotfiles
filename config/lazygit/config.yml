gui:
  screenMode: "normal" # one of 'normal' | 'half' | 'full'
  scrollHeight: 2
  showIcons: true
  showFileTree: true
  border: "rounded" # 'single' | 'double' | 'rounded' | 'hidden'
  theme:
    activeBorderColor:
      - "#89b4fa" # blue
      - bold
    inactiveBorderColor:
      - "#585b70" # overlay
    searchingActiveBorderColor:
      - "#f5c2e7" # pink
      - bold
    optionsTextColor:
      - "#a6e3a1" # green
    selectedLineBgColor:
      - "#313244" # subtle line highlight
    cherryPickedCommitBgColor:
      - "#45475a"
    cherryPickedCommitFgColor:
      - "#89b4fa"
    unstagedChangesColor:
      - "#f38ba8" # red
    defaultFgColor:
      - "#cdd6f4" # foreground
    inactiveViewSelectedLineBgColor:
      - "#313244"
git:
  autoFetch: true
  autoRefresh: true
  pagers:
    - pager: delta --paging=never
# Allow 'Esc' to quit from top level
quitOnTopLevelReturn: true
# Uncomment if you want per-repo overrides later
# localConfig:
#   enabled: true
# Uses OpenRouter Free Models Router (requires OPENROUTER_API_KEY env variable)
# Set your API key: export OPENROUTER_API_KEY="your-key-here"
# Get key at: https://openrouter.ai/keys
customCommands:
  - key: "<c-a>"
    description: "Pick AI commit"
    command: |
      DIFF=$(git diff --cached)
      LOGS=$(git log -n 10 --pretty=format:'%h %s')
      PROMPT="Please suggest 10 commit messages, given the following diff:

      \`\`\`diff
      $DIFF
      \`\`\`

      **Criteria:**
      1. Format: Plain commit messages without prefixes like feat:, fix:, chore:, etc.
      2. Start with a verb in imperative mood (add, update, fix, remove, etc.)
      3. Be clear and concise
      4. Focus on WHAT changed and WHY

      **Commit Message Examples:**
      - add password validation regex
      - update user authentication flow
      - fix memory leak in data processing
      - remove deprecated API endpoints
      - refactor database connection logic

      **Recent Commits for Reference:**
      \`\`\`
      $LOGS
      \`\`\`

      **Output Format:**
      Output ONLY raw commit messages, one per line, without numbers or decorations.

      **Instructions:**
      - Understand the changes in the diff
      - Think about impact (bug fixes, features, performance, refactoring, docs)
      - Abstract to higher level, don't just describe code changes
      - Generate 10 diverse messages covering different scenarios
      - Make them helpful for project history
      - DO NOT use conventional commit prefixes (no feat:, fix:, chore:, etc.)"

      jq -n --arg model "openrouter/auto:free" --arg content "$PROMPT" '{
        model: $model,
        messages: [{role: "user", content: $content}]
      }' | curl -s https://openrouter.ai/api/v1/chat/completions \
        -H "Authorization: Bearer $OPENROUTER_API_KEY" \
        -H "Content-Type: application/json" \
        -d @- \
        | jq -r '.choices[0].message.content' 2>/dev/null \
        | tr -d '\r' \
        | sed 's/\x1b\[[0-9;]*m//g' \
        | grep -vE '^\s*$' \
        | grep -vE '^(#|```|\*\*|-)' \
        | sed 's/^[0-9]\+[\.\)]\s*//' \
        | fzf --height 40% --border --no-ansi --preview "echo {}" --preview-window=up:wrap \
        | {
            SELECTED=$(cat)
            if [ -z "$SELECTED" ]; then
                echo "Cancelled."
                exit 0
            fi
            f=$(mktemp)
            echo "$SELECTED" > "$f"
            original_mtime=$(stat -f %m "$f" 2>/dev/null || stat -c %Y "$f" 2>/dev/null)
            ${EDITOR:-nvim} "$f"
            new_mtime=$(stat -f %m "$f" 2>/dev/null || stat -c %Y "$f" 2>/dev/null)
            if [ -s "$f" ] && [ "$original_mtime" != "$new_mtime" ]; then
                git commit -F "$f"
            else
                echo "Commit aborted (no changes made)."
            fi
            rm -f "$f"
            reset 2>/dev/null || tput reset 2>/dev/null || true
        }
    context: "files"
    output: terminal
  - key: "<c-o>"
    description: "Pick AI commit (Ollama)"
    command: |
      DIFF=$(git diff --cached)
      LOGS=$(git log -n 10 --pretty=format:'%h %s')
      PROMPT="Please suggest 10 commit messages, given the following diff:

      \`\`\`diff
      $DIFF
      \`\`\`

      **Criteria:**
      1. Format: Plain commit messages without prefixes like feat:, fix:, chore:, etc.
      2. Start with a verb in imperative mood (add, update, fix, remove, etc.)
      3. Be clear and concise
      4. Focus on WHAT changed and WHY

      **Commit Message Examples:**
      - add password validation regex
      - update user authentication flow
      - fix memory leak in data processing
      - remove deprecated API endpoints
      - refactor database connection logic

      **Recent Commits for Reference:**
      \`\`\`
      $LOGS
      \`\`\`

      **Output Format:**
      Output ONLY raw commit messages, one per line, without numbers or decorations.

      **Instructions:**
      - Understand the changes in the diff
      - Think about impact (bug fixes, features, performance, refactoring, docs)
      - Abstract to higher level, don't just describe code changes
      - Generate 10 diverse messages covering different scenarios
      - Make them helpful for project history
      - DO NOT use conventional commit prefixes (no feat:, fix:, chore:, etc.)"

      jq -n --arg model "qwen3:8b" --arg content "$PROMPT" '{
        model: $model,
        messages: [{role: "user", content: $content}]
      }' | curl -s https://ollama.local.emrearmagan.dev/v1/chat/completions \
        -H "Content-Type: application/json" \
        -d @- \
        | jq -r '.choices[0].message.content' 2>/dev/null \
        | tr -d '\r' \
        | sed 's/\x1b\[[0-9;]*m//g' \
        | grep -vE '^\s*$' \
        | grep -vE '^(#|```|\*\*|-)' \
        | sed 's/^[0-9]\+[\.\)]\s*//' \
        | fzf --height 40% --border --no-ansi --preview "echo {}" --preview-window=up:wrap \
        | {
            SELECTED=$(cat)
            if [ -z "$SELECTED" ]; then
                echo "Cancelled."
                exit 0
            fi
            f=$(mktemp)
            echo "$SELECTED" > "$f"
            original_mtime=$(stat -f %m "$f" 2>/dev/null || stat -c %Y "$f" 2>/dev/null)
            ${EDITOR:-nvim} "$f"
            new_mtime=$(stat -f %m "$f" 2>/dev/null || stat -c %Y "$f" 2>/dev/null)
            if [ -s "$f" ] && [ "$original_mtime" != "$new_mtime" ]; then
                git commit -F "$f"
            else
                echo "Commit aborted (no changes made)."
            fi
            rm -f "$f"
            reset 2>/dev/null || tput reset 2>/dev/null || true
        }
    context: "files"
    output: terminal
